{"title":"chatGptè¿”å›æ•°æ®å®æ—¶æ›´æ–°(SSE)","uid":"9912943b0301d4d9cf01afa248355baf","slug":"chatGptè¿”å›æ•°æ®å®æ—¶æ›´æ–°-SSE","date":"2023-07-19T13:16:48.000Z","updated":"2023-07-19T13:29:59.329Z","comments":true,"path":"api/articles/chatGptè¿”å›æ•°æ®å®æ—¶æ›´æ–°-SSE.json","keywords":null,"cover":[],"content":"<p><strong>æœåŠ¡å™¨å‘é€äº‹ä»¶ï¼ˆServer-Sent Eventsï¼Œç®€ç§° SSEï¼‰</strong> å…¶å®å°±æ˜¯æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª <code>HTTP</code> è¯·æ±‚ï¼Œç„¶åæœåŠ¡å™¨ä¸æ–­å•å‘åœ°å‘æµè§ˆå™¨æ¨é€æ¶ˆæ¯</p>\n<p>æ‰€è°“çš„æ¶ˆæ¯ï¼Œå…¶å®å°±æ˜¯ä¸€å®šæ ¼å¼çš„æ–‡æœ¬äº‹ä»¶æµï¼ˆæ•°æ®æµï¼‰</p>\n<p><img src=\"chatGpt%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E6%9B%B4%E6%96%B0-SSE/v2-471e38eb6ef654800d28c7d623dd22a8_720w.png\" alt=\"\"></p>\n<h1 id=\"sse-de-te-dian\">SSEçš„ç‰¹ç‚¹</h1>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>åŸºäº <code>http</code> åè®®çš„å•å‘é€šä¿¡</p>\n</li>\n<li class=\"lvl-4\">\n<p>é»˜è®¤æ”¯æŒæ–­çº¿é‡è¿ï¼Œå¹¶æ”¯æŒå‘é€è‡ªå®šä¹‰äº‹ä»¶ç±»å‹æ¶ˆæ¯</p>\n</li>\n<li class=\"lvl-4\">\n<p>åªæ”¯æŒå‘é€æ–‡æœ¬</p>\n</li>\n<li class=\"lvl-4\">\n<p>æ˜¯ <code>WebSocket</code> çš„ä¸€ç§è½»å‹æ›¿ä»£æ–¹æ¡ˆï¼Œå—åŒæºç­–ç•¥çš„é™åˆ¶</p>\n</li>\n<li class=\"lvl-4\">\n<p>å‰ç«¯: ä¸ä½¿ç”¨<code>xhr/fetch</code>,è€Œä½¿ç”¨ç‰¹å®šçš„API : <code>EventSource</code></p>\n</li>\n<li class=\"lvl-4\">\n<p>åç«¯: <code>Content-Type: text/event-stream</code></p>\n</li>\n</ul>\n<h1 id=\"xiao-xi-de-gou-cheng\">æ¶ˆæ¯çš„æ„æˆ</h1>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>æ¶ˆæ¯å”¯ä¸€æ ‡è¯†ï¼ˆidï¼‰</p>\n<p>ç›¸å½“äºæ¯ä¸€æ¡æ•°æ®çš„ç¼–å·ï¼Œå¯é€šè¿‡ <code>lastEventId</code> å±æ€§è¯»å–ã€‚ä¸€æ—¦è¿æ¥ä¸­æ–­ï¼Œæµè§ˆå™¨ä¼šå‘é€åŒ…å« <code>Last-Event-ID: id</code> å¤´ä¿¡æ¯æ¥å¸®åŠ©æœåŠ¡å™¨é‡å»ºè¿æ¥</p>\n</li>\n<li class=\"lvl-4\">\n<p>æ¶ˆæ¯å†…å®¹ï¼ˆdataï¼‰</p>\n<p>åªèƒ½ä¸ºæ–‡æœ¬å­—ç¬¦ä¸²ï¼Œå‘é€ <code>JSON</code> æ•°æ® <code>data:$&#123;JSON.stringify(&#123; name: 'adiu', alias: 'è€å¤«å­' &#125;)&#125;\\n\\n</code></p>\n</li>\n<li class=\"lvl-4\">\n<p>è‡ªå®šä¹‰äº‹ä»¶ç±»å‹ï¼ˆeventï¼‰</p>\n<p>æœåŠ¡å™¨ç«¯å¯è‡ªå®šä¹‰ï¼Œæµè§ˆå™¨ç«¯é€šè¿‡ <code>addEventListener</code> ç›‘å¬ï¼Œå¦‚æœæœªæŒ‡å®šï¼Œåˆ™è§¦å‘æµè§ˆå™¨ç«¯çš„ <code>message</code> äº‹ä»¶</p>\n</li>\n<li class=\"lvl-4\">\n<p>æœ€å¤§é—´éš”æ—¶é—´/æ¯«ç§’ï¼ˆretryï¼‰</p>\n<p>å¦‚æœæœªæŒ‡å®šé€šä¿¡çš„æœ€å¤§é—´éš”æ—¶é—´ï¼ŒæœåŠ¡å™¨ç«¯ <code>3</code> ç§’å†…æ²¡æœ‰å‘é€ä»»ä½•ä¿¡æ¯ï¼Œæµè§ˆå™¨ç«¯é»˜è®¤å¼€å§‹é‡è¿</p>\n<p>ç”±äºç½‘ç»œé”™è¯¯å¯¼è‡´è¿æ¥å‡ºé”™ï¼Œæµè§ˆå™¨ä¹Ÿä¼šè‡ªåŠ¨é‡æ–°å‘èµ·è¿æ¥</p>\n</li>\n</ul>\n<h1 id=\"sse-he-socket-de-qu-bie\">SSEå’ŒSocketçš„åŒºåˆ«</h1>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šä¿¡æ–¹å¼<br>\nSSEä¸ºå•å‘é€šä¿¡,Socketä¸ºå…¨åŒå·¥ã€åŠåŒå·¥é€šä¿¡</p>\n</li>\n<li class=\"lvl-2\">\n<p>åè®®<br>\nSSEä¸ºhttp GET,Socketä¸ºws</p>\n</li>\n<li class=\"lvl-2\">\n<p>è·¨åŸŸ<br>\nSSEä¸èƒ½è·¨åŸŸ,Socketå¯ä»¥è·¨åŸŸ</p>\n</li>\n</ul>\n<h1 id=\"ke-hu-duan-dai-ma\">å®¢æˆ·ç«¯ä»£ç </h1>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒ</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span>window<span class=\"token punctuation\">.</span>EventSource<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'å½“å‰æµè§ˆå™¨æ”¯æŒäº‹ä»¶æ¨é€'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n</li>\n<li class=\"lvl-4\">\n<p>å»ºç«‹è¿æ¥</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span>window<span class=\"token punctuation\">.</span>EventSource<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token keyword\">const</span> ets <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EventSource</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://127.0.0.1/sse/notice'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n</li>\n<li class=\"lvl-4\">\n<p>è¿æ¥çŠ¶æ€ï¼ˆets.readyStateï¼‰</p>\n<p><code>0</code> è¡¨ç¤ºè¿æ¥è¿˜æœªå»ºç«‹ï¼Œæˆ–è€…è¿æ¥æ–­çº¿</p>\n<p><code>1</code> è¡¨ç¤ºè¿æ¥å·²ç»å»ºç«‹ï¼Œå¯ä»¥æ¥å—æ•°æ®</p>\n<p><code>2</code> è¡¨ç¤ºè¿æ¥å·²æ–­ï¼Œä¸”ä¸ä¼šé‡è¿</p>\n</li>\n<li class=\"lvl-4\">\n<p>å»ºç«‹è¿æ¥ï¼Œè§¦å‘äº‹ä»¶</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">ets<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'open'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'handle open event'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>è¿æ¥ä¸€æ—¦å»ºç«‹ï¼Œå°±ä¼šè§¦å‘ <code>open</code> äº‹ä»¶</p>\n</li>\n<li class=\"lvl-4\">\n<p>é”™è¯¯å¤„ç†</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">ets<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'handle error event'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>å¦‚æœå‘ç”Ÿé€šä¿¡é”™è¯¯ï¼ˆæ¯”å¦‚è¿æ¥ä¸­æ–­ï¼‰ï¼Œå°±ä¼šè§¦å‘ <code>error</code> äº‹ä»¶</p>\n</li>\n<li class=\"lvl-4\">\n<p>è‡ªå®šä¹‰äº‹ä»¶</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">ets<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'notice'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span> data<span class=\"token punctuation\">,</span> origin<span class=\"token punctuation\">,</span> lastEventId <span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> event\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'æ¶ˆæ¯å†…å®¹'</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'æœåŠ¡å™¨ç«¯URLçš„åŸŸåéƒ¨åˆ†ï¼Œå³åè®®ã€åŸŸåå’Œç«¯å£'</span><span class=\"token punctuation\">,</span> origin<span class=\"token punctuation\">)</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'æ•°æ®çš„ç¼–å·ï¼Œç”±æœåŠ¡å™¨ç«¯å‘é€ã€‚å¦‚æœæ²¡æœ‰ç¼–å·ï¼Œè¿™ä¸ªå±æ€§ä¸ºç©º'</span><span class=\"token punctuation\">,</span> lastEventId<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li class=\"lvl-4\">\n<p>å…³é—­æ¨é€</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">ets<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„è¿æ¥å…³é—­ï¼Œåˆ™ä¼šè‡ªåŠ¨é‡è¿ã€‚å¯ä»¥é€šè¿‡ <code>close()</code> æ–¹æ³•ç»ˆæ­¢è¿æ¥</p>\n</li>\n</ul>\n<p><strong>å®æˆ˜</strong></p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>X-UA-Compatible<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>IE=edge<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>chatgpt stream å“åº”æ•°æ®SSEæµ‹è¯• demo<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>è¯·æ±‚æ¥å£<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>result<span class=\"token punctuation\">\"</span></span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"><span class=\"token property\">word-wrap</span><span class=\"token punctuation\">:</span> break-word<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>module<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">let</span> resultEl <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#result'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// SSE https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events/Using_server-sent_events#%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8E%A5%E5%8F%97%E4%BA%8B%E4%BB%B6</span>\n    <span class=\"token comment\">// å‰ç«¯ EventStream API å‘èµ·è¯·æ±‚ï¼Œåç«¯ Koaï¼Œctx.body è®¾ç½® stream å¯å†™æµï¼Œctx.set å“åº”ç±»å‹ text/event-streamã€‚</span>\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".btn\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">const</span> evtSource <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EventSource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/open-ai/sendMsg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        evtSource<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onmessage</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message: \"</span> <span class=\"token operator\">+</span> event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          resultEl<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">+=</span> event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"zhu-yi-shi-xiang\">æ³¨æ„äº‹é¡¹</h1>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>ç”±äºä¼ è¾“çš„æ•°æ®æ ¼å¼å¿…é¡»æ˜¯æ–‡æœ¬ï¼Œæ‰€ä»¥æ¯ä¸ªå­—æ®µä¹‹é—´è¦ç”¨æ¢è¡Œç¬¦ <code>\\n</code> éš”å¼€ï¼Œæœ€åä¸€ä¸ªå­—æ®µè¦ç”¨ <code>\\n\\n</code> è¡¨ç¤ºä¸€æ¡æ¶ˆæ¯çš„ç»“æŸ</p>\n</li>\n<li class=\"lvl-4\">\n<p>æœåŠ¡ç«¯å‘é€æ•°æ®æ—¶å¿…é¡»è®¾ç½®å“åº”å¤´æ ‡è¯†æ¨é€çš„æ•°æ®æ˜¯æµä¿¡æ¯ <code>Content-Type: text/event-stream</code></p>\n</li>\n<li class=\"lvl-4\">\n<p>ä¸å»ºè®®ç¼“å­˜äº‹ä»¶æ¨é€æ•°æ®</p>\n</li>\n<li class=\"lvl-4\">\n<p>å¦‚æœç”¨æˆ·é‡å¾ˆå¤šï¼Œå°±éœ€è¦ä¿æŒå¾ˆå¤šé•¿è¿æ¥ï¼Œå› æ­¤ä¼š<strong>å ç”¨æœåŠ¡å™¨å¤§é‡å†…å­˜å’Œè¿æ¥æ•°</strong></p>\n</li>\n</ul>\n<p>è‹¥å‰ç«¯éƒ¨ç½²ä½¿ç”¨çš„æ˜¯Nginxé…ç½®</p>\n<h1 id=\"nginx-pei-zhi-ruo-bu-jin-xing-pei-zhi-qian-duan-wu-fa-jie-shou\">Nginxé…ç½®(è‹¥ä¸è¿›è¡Œé…ç½®,å‰ç«¯æ— æ³•æ¥æ”¶)</h1>\n<p><strong>è¿™å¹¶ä¸æ˜¯æœ€ä¼˜è§£</strong></p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">server<span class=\"token punctuation\">&#123;</span>\n\tlisten <span class=\"token number\">80</span>;\n\tserver_name test.com;\n\tlocation / <span class=\"token punctuation\">&#123;</span>\n\t\tproxy_pass http<span class=\"token operator\">:</span><span class=\"token comment\">//127.0.0.1:9000</span>\n\t\t#ä¿®å¤sse eventSource æ— æ³•æ¥æ”¶åˆ°æ¶ˆæ¯çš„é—®é¢˜\n\t\tproxy_set_header Connection '';\n\t\tproxy_http_version <span class=\"token number\">1.1</span>;\n\t\tchunked_transfer_encoding off;\n\t\t<span class=\"token comment\">// é»˜è®¤é…ç½®ä¸­proxy_bufferingæ˜¯on,SSEçš„å®æ—¶æ€§è¢«æ‰“ç ´äº†,æœ‰ç¼“å­˜,å‰ç«¯ä¸ä¼šå®šæ—¶è¾“å‡º</span>\n\t\tproxy_buffering off;  \n\t\tproxy_cache off;\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><strong>æœ€ä¼˜è§£æ˜¯åç«¯è¿”å›çš„æ¥å£å“åº”å¤´ä¸­è®¾ç½® <code>Cache-Control:no-cache</code></strong></p>\n","text":"æœåŠ¡å™¨å‘é€äº‹ä»¶ï¼ˆServer-Sent Eventsï¼Œç®€ç§° SSEï¼‰ å…¶å®å°±æ˜¯æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œç„¶åæœåŠ¡å™¨ä¸æ–­å•å‘åœ°å‘æµè§ˆå™¨æ¨é€æ¶ˆæ¯ æ‰€è°“çš„æ¶ˆæ¯ï¼Œå…¶å®å°±æ˜¯ä¸€å®šæ ¼å¼çš„æ–‡æœ¬äº‹ä»¶æµï¼ˆæ•°æ®æµï¼‰ SSEçš„ç‰¹ç‚¹ åŸºäº http åè®®çš„å•å‘é€šä¿¡ é»˜è®¤æ”¯æŒæ–­çº¿é‡è¿ï¼Œå¹¶æ”¯æŒå‘...","link":"","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","count":12,"path":"api/categories/å‰ç«¯.json"},{"name":"ä¸šåŠ¡ä¸æ€§èƒ½ä¼˜åŒ–","slug":"å‰ç«¯/ä¸šåŠ¡ä¸æ€§èƒ½ä¼˜åŒ–","count":10,"path":"api/categories/å‰ç«¯/ä¸šåŠ¡ä¸æ€§èƒ½ä¼˜åŒ–.json"}],"tags":[{"name":"ä¸šåŠ¡ä¸æ€§èƒ½ä¼˜åŒ–(å‰ç«¯)","slug":"ä¸šåŠ¡ä¸æ€§èƒ½ä¼˜åŒ–-å‰ç«¯","count":10,"path":"api/tags/ä¸šåŠ¡ä¸æ€§èƒ½ä¼˜åŒ–-å‰ç«¯.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#sse-de-te-dian\"><span class=\"toc-text\">SSEçš„ç‰¹ç‚¹</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#xiao-xi-de-gou-cheng\"><span class=\"toc-text\">æ¶ˆæ¯çš„æ„æˆ</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#sse-he-socket-de-qu-bie\"><span class=\"toc-text\">SSEå’ŒSocketçš„åŒºåˆ«</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#ke-hu-duan-dai-ma\"><span class=\"toc-text\">å®¢æˆ·ç«¯ä»£ç </span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#zhu-yi-shi-xiang\"><span class=\"toc-text\">æ³¨æ„äº‹é¡¹</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#nginx-pei-zhi-ruo-bu-jin-xing-pei-zhi-qian-duan-wu-fa-jie-shou\"><span class=\"toc-text\">Nginxé…ç½®(è‹¥ä¸è¿›è¡Œé…ç½®,å‰ç«¯æ— æ³•æ¥æ”¶)</span></a></li></ol>","author":{"name":"ND_LJQ","slug":"blog-author","avatar":"/svg/head.jpg","link":"/","description":"ä¸€ä½æ­£åœ¨æ‘†çƒ‚çš„å¤§å››æ¸£æ»“ğŸ˜‹ <br /> @ <b>åŠ‰ä¸‰åˆ€çš„æ‘†çƒ‚ç”Ÿæ´»</b>","socials":{"github":"https://github.com/ND-LJQ","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/qq_52475868?type=blog","juejin":"https://juejin.cn/user/2032336272362109","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/391491132?spm_id_from=333.1007.0.0"},"gitee":{"icon":"/svg/gitee-fill-round.svg","link":"https://gitee.com/liu-jq"}}}},"mapped":true,"prev_post":{"title":"éå†ä¸€æ¬¡æŠŠæ‰å¹³æ•°ç»„è½¬Tree","uid":"cf49f6c451570ecd3976ecdcea1f962a","slug":"éå†ä¸€æ¬¡æŠŠæ‰å¹³æ•°ç»„è½¬Tree","date":"2023-07-19T13:17:11.000Z","updated":"2023-07-19T13:40:50.949Z","comments":true,"path":"api/articles/éå†ä¸€æ¬¡æŠŠæ‰å¹³æ•°ç»„è½¬Tree.json","keywords":null,"cover":[],"text":"æ ‘ç»“æ„ï¼ˆTreeï¼‰ æ˜¯ä¸€ç§å…¸å‹çš„éçº¿æ€§æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯ç”± n (n &gt; 0) ä¸ªæœ‰é™èŠ‚ç‚¹ç»„æˆçš„ä¸€ä¸ªå…·æœ‰å±‚æ¬¡å…³ç³»çš„é›†åˆ åœ¨å®é™…çš„å·¥ä½œä¸­ï¼Œä¸ºäº†æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Œéœ€è¦æŠŠåç«¯è¿”å›çš„æ‰å¹³åŒ–çš„æ•°ç»„ç»“æ„ï¼Œè½¬æ¢æˆæ ‘å½¢ç»“æ„ æ•°æ®ç»“æ„ æ‰å¹³æ•°æ® [ &#123; id: 1, pid: null, ...","link":"","photos":[],"count_time":{"symbolsCount":"2.5k","symbolsTime":"2 mins."},"categories":[],"tags":[],"author":{"name":"ND_LJQ","slug":"blog-author","avatar":"/svg/head.jpg","link":"/","description":"ä¸€ä½æ­£åœ¨æ‘†çƒ‚çš„å¤§å››æ¸£æ»“ğŸ˜‹ <br /> @ <b>åŠ‰ä¸‰åˆ€çš„æ‘†çƒ‚ç”Ÿæ´»</b>","socials":{"github":"https://github.com/ND-LJQ","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/qq_52475868?type=blog","juejin":"https://juejin.cn/user/2032336272362109","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/391491132?spm_id_from=333.1007.0.0"},"gitee":{"icon":"/svg/gitee-fill-round.svg","link":"https://gitee.com/liu-jq"}}}}},"next_post":{"title":"é•¿ä»»åŠ¡ä¼˜åŒ–","uid":"4bb3e720239fee0f6b9b7f2b0b357704","slug":"é•¿ä»»åŠ¡ä¼˜åŒ–","date":"2023-07-19T13:16:03.000Z","updated":"2023-07-19T14:10:13.588Z","comments":true,"path":"api/articles/é•¿ä»»åŠ¡ä¼˜åŒ–.json","keywords":null,"cover":[],"text":"ç”±äºæµè§ˆå™¨ GUI æ¸²æŸ“çº¿ç¨‹ä¸ JS å¼•æ“çº¿ç¨‹æ˜¯äº’æ–¥çš„å…³ç³»ï¼Œå½“é¡µé¢ä¸­æœ‰å¾ˆå¤šé•¿ä»»åŠ¡æ—¶ï¼Œä¼šé€ æˆé¡µé¢ UI é˜»å¡ï¼Œå‡ºç°ç•Œé¢å¡é¡¿ã€æ‰å¸§ç­‰æƒ…å†µ æŸ¥çœ‹é¡µé¢çš„é•¿ä»»åŠ¡ï¼š æ‰“å¼€æ§åˆ¶å°ï¼Œé€‰æ‹© Performance å·¥å…·ï¼Œç‚¹å‡» Start æŒ‰é’®ï¼Œå±•å¼€ Main é€‰é¡¹ï¼Œä¼šå‘ç°æœ‰å¾ˆå¤šçº¢è‰²çš„ä¸‰è§’ï¼Œè¿™äº›å°±å±...","link":"","photos":[],"count_time":{"symbolsCount":"11k","symbolsTime":"10 mins."},"categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","count":12,"path":"api/categories/å‰ç«¯.json"},{"name":"ä¸šåŠ¡ä¸æ€§èƒ½ä¼˜åŒ–","slug":"å‰ç«¯/ä¸šåŠ¡ä¸æ€§èƒ½ä¼˜åŒ–","count":10,"path":"api/categories/å‰ç«¯/ä¸šåŠ¡ä¸æ€§èƒ½ä¼˜åŒ–.json"}],"tags":[{"name":"ä¸šåŠ¡ä¸æ€§èƒ½ä¼˜åŒ–(å‰ç«¯)","slug":"ä¸šåŠ¡ä¸æ€§èƒ½ä¼˜åŒ–-å‰ç«¯","count":10,"path":"api/tags/ä¸šåŠ¡ä¸æ€§èƒ½ä¼˜åŒ–-å‰ç«¯.json"}],"author":{"name":"ND_LJQ","slug":"blog-author","avatar":"/svg/head.jpg","link":"/","description":"ä¸€ä½æ­£åœ¨æ‘†çƒ‚çš„å¤§å››æ¸£æ»“ğŸ˜‹ <br /> @ <b>åŠ‰ä¸‰åˆ€çš„æ‘†çƒ‚ç”Ÿæ´»</b>","socials":{"github":"https://github.com/ND-LJQ","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/qq_52475868?type=blog","juejin":"https://juejin.cn/user/2032336272362109","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/391491132?spm_id_from=333.1007.0.0"},"gitee":{"icon":"/svg/gitee-fill-round.svg","link":"https://gitee.com/liu-jq"}}}}}}