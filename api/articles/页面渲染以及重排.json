{"title":"页面渲染以及重排","uid":"81ec849fc0ebda5e058742eb82eb6d73","slug":"页面渲染以及重排","date":"2023-07-19T13:19:55.000Z","updated":"2023-07-19T13:39:14.798Z","comments":true,"path":"api/articles/页面渲染以及重排.json","keywords":null,"cover":[],"content":"<p>用户使用浏览器一般会打开多个页面，现代浏览器使用单独的进程 <code>Render Process</code> 渲染每个页面，<strong>以提升页面性能和稳定性</strong></p>\n<p><img src=\"/post/%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E4%BB%A5%E5%8F%8A%E9%87%8D%E6%8E%92.htm/4c64312ae3fe443ba16bf18e51fa005e~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp\" alt></p>\n<h1 id=\"ye-mian-de-xuan-ran\">页面的渲染</h1>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>渲染图示</p>\n<p><img src=\"/post/%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E4%BB%A5%E5%8F%8A%E9%87%8D%E6%8E%92.htm/79daae1a55a64877a7ed32bca62f39de~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp\" alt></p>\n</li>\n<li class=\"lvl-2\">\n<p>渲染图解</p>\n<p>根据 <code>HTML 标记</code> 解析出 <code>DOM 树</code></p>\n<p>根据 <code>CSS 样式</code> 解析出 <code>CSS 规则树</code></p>\n<p>根据 <code>DOM 树</code> 和 <code>CSS 规则树</code> 生成 <code>渲染树</code></p>\n<p>根据渲染树计算 DOM 节点的信息（节点的大小、位置等）</p>\n<p>根据计算好的信息绘制页面（颜色、背景、字体等）</p>\n</li>\n</ul>\n<h1 id=\"zhong-hui-he-hui-liu\">重绘和回流</h1>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>重绘（repaint）</p>\n<p>当 <code>DOM</code> 元素的外观属性发生变化时，如：字体颜色或背景颜色</p>\n<p>浏览器会重新绘制受影响的元素到屏幕，这个过程称之为<strong>重绘</strong></p>\n</li>\n<li class=\"lvl-2\">\n<p>回流（reflow）</p>\n<p>当 <code>DOM</code> 元素的几何属性发生变化时，如：盒子模型相关的属性。其周围元素的位置也会受到影响</p>\n<p>浏览器会重新生成渲染树且重新布局，这个过程称之为<strong>回流</strong></p>\n</li>\n<li class=\"lvl-2\">\n<p>影响关系</p>\n<p>重绘不一定导致回流，但回流一定会导致重绘</p>\n</li>\n</ul>\n<h1 id=\"chang-jian-zhong-hui-hui-liu-yi-ji-you-hua-fang-an\">常见重绘、回流以及优化方案</h1>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>常见场景</p>\n</li>\n</ul>\n<p>​\t\t浏览器的窗口大小改变（resize 事件）</p>\n<p>​\t\t添加或删除可见的 <code>DOM</code> 元素（必要的 DOM 操作）</p>\n<p>​\t\t页面中的内容发生变化</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>优化方案</p>\n</li>\n</ul>\n<p>​\t\t使用 <code>document.createDocumentFragement()</code> 优化必要的 DOM 操作</p>\n<p>​\t\t使用 <code>opacity</code>、<code>transform</code>、<code>3D转换属性</code> 开启动画的 GPU 加速</p>\n<p>​\t\t使用 <code>el.style.cssText</code> 替代 <code>el.style</code> 来集中改变样式</p>\n<p>​\t\t使用 <code>textContent</code> 替代 <code>innerText</code> 来动态修改页面中的内容</p>\n<p>​\t\t使用 <code>will-change</code> 属性提前通知浏览器元素将要做什么，让浏览器提前准备合适的优化机制，增强页面的动画渲染性能</p>\n<pre><code>  `will-change` 应该被视为最后的应对手段，用于解决现有的性能问题。不应该被用来预测性能问题。\n</code></pre>\n<h1 id=\"shi-zhan\">实战</h1>\n<p>滑动选项卡</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>基本结构</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tab<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tabId<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tab-nav<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>slider<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>slider<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">data-index</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>导航项<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tab-content<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>滑动内容<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li class=\"lvl-2\">\n<p>布局技巧</p>\n<pre class=\"line-numbers language-css\" data-language=\"css\"><code class=\"language-css\"><span class=\"token selector\">.tab</span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span> hidden<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token selector\">.tab-nav > .slider</span><span class=\"token punctuation\">&#123;</span>\n  <span class=\"token property\">transition</span><span class=\"token punctuation\">:</span> left .3s ease<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token selector\">.tab-nav:hover</span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token property\">will-change</span><span class=\"token punctuation\">:</span> margin-left<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token selector\">.tab-content</span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">transition</span><span class=\"token punctuation\">:</span> margin-left .3s ease<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token selector\">.tab-content > div</span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token property\">flex-shrink</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><code>flex-shrink</code> 定义元素占多余空间的缩小比例（子元素的宽度和大于父元素的宽度时起作用），默认值为 <code>1</code> ，即空间不足时，元素都将等比例缩小</p>\n<p>如果 <code>flex-shrink</code> 的属性设为 <code>0</code> 时，则空间不足时不进行缩小</p>\n</li>\n<li class=\"lvl-2\">\n<p>绑定事件实现滑动</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> tabId <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#tabId'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> tabNav <span class=\"token operator\">=</span> tabId<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.tab-nav'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> tabSlideBar <span class=\"token operator\">=</span> tabId<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.slider'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> tabSlideContent <span class=\"token operator\">=</span> tabId<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.tab-content'</span><span class=\"token punctuation\">)</span>\ntabNav<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token keyword\">const</span> index <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>index\n  tabSlideBar<span class=\"token punctuation\">.</span>style <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">left: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>offsetLeft<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">px;</span><span class=\"token template-punctuation string\">`</span></span>\n  tabSlideContent<span class=\"token punctuation\">.</span>style <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">margin-left: -</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>index <span class=\"token operator\">*</span> <span class=\"token number\">100</span><span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">%;</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n</ul>\n<p><strong>场景</strong>:</p>\n<p>列表页会有很多商品图片，自适应没有用css定义图片高度，当图片加载完成后会发生重排。为了避免这样的情况，是需要用css定好图片宽高吗？</p>\n<p>为了避免重排，所以要限定好图片宽高,自适应的图片，建议使用第三方CDN 结合picture标签来处理</p>\n","feature":true,"text":"用户使用浏览器一般会打开多个页面，现代浏览器使用单独的进程 Render Process 渲染每个页面，以提升页面性能和稳定性 页面的渲染 渲染图示 渲染图解 根据 HTML 标记 解析出 DOM 树 根据 CSS 样式 解析出 CSS 规则树 根据 DOM 树 和 CSS 规则...","link":"","photos":[],"count_time":{"symbolsCount":"2.1k","symbolsTime":"2 mins."},"categories":[{"name":"前端","slug":"前端","count":12,"path":"api/categories/前端.json"},{"name":"业务与性能优化","slug":"前端/业务与性能优化","count":10,"path":"api/categories/前端/业务与性能优化.json"}],"tags":[{"name":"业务与性能优化(前端)","slug":"业务与性能优化-前端","count":10,"path":"api/tags/业务与性能优化-前端.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#ye-mian-de-xuan-ran\"><span class=\"toc-text\">页面的渲染</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#zhong-hui-he-hui-liu\"><span class=\"toc-text\">重绘和回流</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#chang-jian-zhong-hui-hui-liu-yi-ji-you-hua-fang-an\"><span class=\"toc-text\">常见重绘、回流以及优化方案</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#shi-zhan\"><span class=\"toc-text\">实战</span></a></li></ol>","author":{"name":"ND_LJQ","slug":"blog-author","avatar":"static/img/head.jpg","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"File&Blob","uid":"497c273b21b6384f2b97078d8e2b85c3","slug":"File&Blob","date":"2023-07-19T14:19:55.000Z","updated":"2023-07-19T14:23:18.596Z","comments":true,"path":"api/articles/File&Blob.json","keywords":null,"cover":[],"text":"什么是文件 这是一张纯色图片 文件的内容 这是他的二进制代码格式: 以下是一些常见的文件的二进制代码前缀 .exe的： MZ? + This program cannot be run in DOS mode. .jpg的： JFIF Or Exif .png： NG .zip：...","link":"","photos":[],"count_time":{"symbolsCount":"9.2k","symbolsTime":"8 mins."},"categories":[{"name":"前端","slug":"前端","count":12,"path":"api/categories/前端.json"},{"name":"基本概念","slug":"前端/基本概念","count":1,"path":"api/categories/前端/基本概念.json"}],"tags":[{"name":"基本概念(前端)","slug":"基本概念-前端","count":1,"path":"api/tags/基本概念-前端.json"}],"author":{"name":"ND_LJQ","slug":"blog-author","avatar":"static/img/head.jpg","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"网络传输优化","uid":"ba4943db0729dc2efbbff5980075647c","slug":"网络传输优化","date":"2023-07-19T13:19:39.000Z","updated":"2023-07-19T13:43:10.839Z","comments":true,"path":"api/articles/网络传输优化.json","keywords":null,"cover":[],"text":"浏览器从输入地址到页面显示的过程中发生了什么？ 1、浏览器对输入的地址进行 URL 解析 2、缓存解析，如 浏览器缓存、系统缓存、路由器缓存 等 3、通过 DNS 服务器将主机域名转换为 IP 地址 4、根据 IP 地址找到对应的服务器，发起 TCP 连接 5、建立 TCP 连接...","link":"","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[{"name":"前端","slug":"前端","count":12,"path":"api/categories/前端.json"},{"name":"业务与性能优化","slug":"前端/业务与性能优化","count":10,"path":"api/categories/前端/业务与性能优化.json"}],"tags":[{"name":"业务与性能优化(前端)","slug":"业务与性能优化-前端","count":10,"path":"api/tags/业务与性能优化-前端.json"}],"author":{"name":"ND_LJQ","slug":"blog-author","avatar":"static/img/head.jpg","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}